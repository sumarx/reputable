<% content_for :page_title, "Dashboard" %>

<div class="space-y-5">
  <turbo-frame id="dashboard_content">
    <%# Header with filters %>
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3">
      <div>
        <h1 class="text-xl font-bold text-gray-900">Dashboard<%= " Â· #{@current_location.name}" if @current_location %></h1>
        <p class="text-sm text-gray-500">Good <%= Time.current.hour < 12 ? 'morning' : Time.current.hour < 17 ? 'afternoon' : 'evening' %> ðŸ‘‹ <%= @current_location ? "Showing #{@current_location.name}" : "All locations overview" %>.</p>
      </div>
      <%= render "dashboard/period_filter" %>
    </div>

    <%# KPI Cards %>
    <div class="grid grid-cols-2 md:grid-cols-3 xl:grid-cols-5 gap-3 mt-4 mb-5">
      <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl flex items-center justify-center shrink-0" style="background-color: #EEF2FF;">
            <svg class="w-5 h-5" style="color: #4F46E5;" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path></svg>
          </div>
          <div class="min-w-0">
            <p class="text-xs text-gray-500">New Reviews</p>
            <p class="text-xl font-bold text-gray-900"><%= number_with_delimiter(@kpi[:new_reviews]) %></p>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl flex items-center justify-center shrink-0" style="background-color: #DBEAFE;">
            <svg class="w-5 h-5" style="color: #2563EB;" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path></svg>
          </div>
          <div class="min-w-0">
            <p class="text-xs text-gray-500">Total Reviews</p>
            <div class="flex items-baseline gap-1.5">
              <p class="text-xl font-bold text-gray-900"><%= number_with_delimiter(@kpi[:total_reviews][:value]) %></p>
              <%= render "dashboard/trend_badge", trend: @kpi[:total_reviews][:trend] %>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl flex items-center justify-center shrink-0" style="background-color: #FEF3C7;">
            <svg class="w-5 h-5" style="color: #F59E0B;" fill="currentColor" viewBox="0 0 20 20"><path d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z"></path></svg>
          </div>
          <div class="min-w-0">
            <p class="text-xs text-gray-500">Avg Rating</p>
            <div class="flex items-baseline gap-1.5">
              <p class="text-xl font-bold text-gray-900"><%= @kpi[:average_rating][:value] %></p>
              <span class="text-xs text-gray-400">/5</span>
              <%= render "dashboard/trend_badge", trend: @kpi[:average_rating][:trend] %>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-4">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl flex items-center justify-center shrink-0" style="background-color: #D1FAE5;">
            <svg class="w-5 h-5" style="color: #059669;" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
          </div>
          <div class="min-w-0">
            <p class="text-xs text-gray-500">Response</p>
            <div class="flex items-baseline gap-1.5">
              <p class="text-xl font-bold text-gray-900"><%= @kpi[:response_rate][:value] %><span class="text-sm font-medium">%</span></p>
              <%= render "dashboard/trend_badge", trend: @kpi[:response_rate][:trend] %>
            </div>
          </div>
        </div>
      </div>

      <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-4 col-span-2 md:col-span-1">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 rounded-xl flex items-center justify-center shrink-0" style="background-color: #EDE9FE;">
            <svg class="w-5 h-5" style="color: #7C3AED;" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6"></path></svg>
          </div>
          <div class="min-w-0">
            <p class="text-xs text-gray-500">Sentiment</p>
            <div class="flex items-baseline gap-1.5">
              <p class="text-xl font-bold text-gray-900"><%= @kpi[:sentiment_score][:value] %><span class="text-sm font-medium">%</span></p>
              <%= render "dashboard/trend_badge", trend: @kpi[:sentiment_score][:trend] %>
            </div>
          </div>
        </div>
      </div>
    </div>

    <%# AI Insights %>
    <%= render "dashboard/ai_insights" %>

    <%# Charts %>
    <div class="mt-5">
      <%= render "dashboard/charts" %>
    </div>

    <%# Response Management + Recent Reviews %>
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-5 mt-5">
      <%= render "dashboard/response_management" %>
      <%= render "dashboard/recent_reviews" %>
    </div>

    <%# Campaign Performance â€” compact summary %>
    <div class="mt-5">
      <div class="bg-white rounded-xl border border-gray-100 shadow-sm">
        <div class="px-5 py-3 border-b border-gray-100 flex items-center justify-between">
          <div>
            <h3 class="text-sm font-semibold text-gray-900">Campaign Performance</h3>
            <p class="text-xs text-gray-400"><%= @campaign_stats[:active_campaigns] %> active</p>
          </div>
          <%= link_to "View Analytics â†’", analytics_campaigns_path, class: "text-xs font-medium hover:opacity-80", style: "color: #4F46E5;", data: { turbo_frame: "_top" } %>
        </div>

        <div class="grid grid-cols-2 sm:grid-cols-4 divide-x divide-gray-100 p-1">
          <% [
            ["Responses", @campaign_stats[:total_responses], "#111827"],
            ["Redirected", @campaign_stats[:total_redirects], "#059669"],
            ["Clicked", @campaign_stats[:total_clicked], "#4F46E5"],
            ["Private", @campaign_stats[:total_responses] - @campaign_stats[:total_redirects], "#D97706"]
          ].each do |label, value, color| %>
            <div class="p-4 text-center">
              <p class="text-2xl font-bold" style="color: <%= color %>;"><%= value %></p>
              <p class="text-xs text-gray-500 mt-0.5"><%= label %></p>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <%# Quick Actions â€” beautiful cards %>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mt-5">
      <%= link_to new_location_path, class: "group block", data: { turbo_frame: "_top" } do %>
        <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-5 hover:shadow-md hover:border-indigo-200 transition-all">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 rounded-xl flex items-center justify-center shrink-0" style="background-color: #EEF2FF;">
              <svg class="w-6 h-6" style="color: #4F46E5;" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path></svg>
            </div>
            <div>
              <p class="text-sm font-semibold text-gray-900 group-hover:text-indigo-600 transition-colors">Add Location</p>
              <p class="text-xs text-gray-500 mt-0.5">Connect a new restaurant</p>
            </div>
          </div>
        </div>
      <% end %>

      <%= link_to new_campaign_path, class: "group block", data: { turbo_frame: "_top" } do %>
        <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-5 hover:shadow-md hover:border-emerald-200 transition-all">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 rounded-xl flex items-center justify-center shrink-0" style="background-color: #ECFDF5;">
              <svg class="w-6 h-6" style="color: #059669;" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v1m6 11h2m-6 0h-2v4m0-11v3m0 0h.01M12 12h4.01M16 20h4M4 12h4m12 0h.01M5 8h2a1 1 0 001-1V5a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1zm12 0h2a1 1 0 001-1V5a1 1 0 00-1-1h-2a1 1 0 00-1 1v2a1 1 0 001 1zM5 20h2a1 1 0 001-1v-2a1 1 0 00-1-1H5a1 1 0 00-1 1v2a1 1 0 001 1z"></path></svg>
            </div>
            <div>
              <p class="text-sm font-semibold text-gray-900 group-hover:text-emerald-600 transition-colors">Create Campaign</p>
              <p class="text-xs text-gray-500 mt-0.5">Set up a QR feedback campaign</p>
            </div>
          </div>
        </div>
      <% end %>

      <%= link_to reviews_path(filter: "unreplied"), class: "group block", data: { turbo_frame: "_top" } do %>
        <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-5 hover:shadow-md hover:border-amber-200 transition-all">
          <div class="flex items-center gap-4">
            <div class="w-12 h-12 rounded-xl flex items-center justify-center shrink-0" style="background-color: #FEF3C7;">
              <svg class="w-6 h-6" style="color: #D97706;" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"></path></svg>
            </div>
            <div>
              <p class="text-sm font-semibold text-gray-900 group-hover:text-amber-600 transition-colors">Reply to Reviews</p>
              <p class="text-xs text-gray-500 mt-0.5"><%= @stats_service.unreplied_count %> reviews need a reply</p>
            </div>
          </div>
        </div>
      <% end %>

      <% if Current.account.locations.count > 1 %>
        <%= link_to locations_comparison_path, class: "group block", data: { turbo_frame: "_top" } do %>
          <div class="bg-white rounded-xl border border-gray-100 shadow-sm p-5 hover:shadow-md hover:border-purple-200 transition-all">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 rounded-xl flex items-center justify-center shrink-0" style="background-color: #F3E8FF;">
                <svg class="w-6 h-6" style="color: #7C3AED;" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path></svg>
              </div>
              <div>
                <p class="text-sm font-semibold text-gray-900 group-hover:text-purple-600 transition-colors">Compare Locations</p>
                <p class="text-xs text-gray-500 mt-0.5"><%= Current.account.locations.count %> locations side by side</p>
              </div>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </turbo-frame>
</div>
