<% if reply_drafts.any? %>
  <h3 class="text-sm font-semibold text-gray-900 mb-4">Reply Drafts</h3>
  <div class="space-y-4">
    <% reply_drafts.each do |draft| %>
      <div class="border border-gray-100 rounded-xl p-4">
        <div class="flex items-center justify-between mb-3">
          <span class="inline-flex items-center px-2 py-0.5 rounded-md text-xs font-medium bg-indigo-50 text-indigo-700"><%= draft.tone&.capitalize %></span>
          <span class="text-xs text-gray-400"><%= draft.status&.capitalize %></span>
        </div>

        <%# Edit/Save form %>
        <%= form_with model: draft, url: reply_draft_path(draft), method: :patch, class: "mb-3" do |f| %>
          <%= f.text_area :body, rows: 3, class: "w-full rounded-lg border-gray-200 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 text-sm" %>
          <div class="mt-2">
            <%= f.submit "Save", class: "inline-flex items-center px-3 py-1.5 border border-gray-200 text-xs font-medium rounded-lg text-gray-700 bg-white hover:bg-gray-50 cursor-pointer transition-colors" %>
          </div>
        <% end %>

        <%# Action buttons â€” separate forms to avoid nesting %>
        <div class="flex flex-wrap gap-2 pt-3 border-t border-gray-100">
          <% unless draft.approved? %>
            <%= button_to "Approve", approve_reply_draft_path(draft), method: :post, class: "inline-flex items-center px-3 py-1.5 border border-transparent text-xs font-medium rounded-lg text-white bg-green-600 hover:bg-green-700 cursor-pointer transition-colors" %>
          <% end %>
          <%= button_to send_reply_reply_draft_path(draft), method: :post, data: { turbo_confirm: "This will save the reply and try to post it to Google. Continue?" }, class: "inline-flex items-center gap-1 px-3 py-1.5 border border-transparent text-xs font-medium rounded-lg text-white bg-indigo-600 hover:bg-indigo-700 cursor-pointer transition-colors" do %>
            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>
            Post Reply
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
<% end %>
